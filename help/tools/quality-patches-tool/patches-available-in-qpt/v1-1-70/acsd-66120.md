---
title: 'ACSD-66120: [!DNL GraphQL] exibe porcentagens de desconto e preços base incorretos quando os preços de catálogo incluem imposto'
description: Aplique o patch ACSD-66120 para corrigir o problema do Adobe Commerce em que [!DNL GraphQL] exibe incorretamente porcentagens de desconto e preços base quando os preços do catálogo estão configurados para incluir imposto. Esse problema causou discrepâncias de arredondamento, como mostrar um desconto de 19,99% em vez dos 20% esperados.
feature: GraphQL
role: Admin, Developer
type: Troubleshooting
source-git-commit: 237ec3fb5834b4130eee1ce121dfcd2655c851de
workflow-type: tm+mt
source-wordcount: '500'
ht-degree: 0%

---


# ACSD-66120: [!DNL GraphQL] exibe porcentagens de desconto e preços base incorretos quando os preços do catálogo incluem imposto

O patch ACSD-66120 corrige o problema em que [!DNL GraphQL] exibe incorretamente porcentagens de desconto e preços base quando os preços do catálogo são configurados para incluir imposto. Esse problema causou discrepâncias de arredondamento, como mostrar um desconto de 19,99% em vez dos 20% esperados. Este patch está disponível quando o [[!DNL Quality Patches Tool (QPT)]](/help/tools/quality-patches-tool/quality-patches-tool-to-self-serve-quality-patches.md) 1.1.70 está instalado. A ID do patch é ACSD-66120. Observe que esse problema está programado para ser corrigido no Adobe Commerce 2.4.9.

## Produtos e versões afetados

**O patch foi criado para a versão do Adobe Commerce:**

* Adobe Commerce (todos os métodos de implantação) 2.4.6-p9

**Compatível com as versões do Adobe Commerce:**

* Adobe Commerce (todos os métodos de implantação) 2.4.4 - 2.4.8-p2

>[!NOTE]
>
>O patch pode se tornar aplicável a outras versões com as novas versões do [!DNL Quality Patches Tool]. Para verificar se o patch é compatível com a sua versão do Adobe Commerce, atualize o pacote `magento/quality-patches` para a versão mais recente e verifique a compatibilidade na [[!DNL Quality Patches Tool]: página Procurar patches](https://experienceleague.adobe.com/tools/commerce-quality-patches/index.html). Use a ID do patch como palavra-chave de pesquisa para localizar o patch.

## Problema

O GraphQL exibe incorretamente as porcentagens de desconto e os preços base quando os preços de catálogo são configurados para incluir imposto. Devido a erros de arredondamento, a porcentagem de desconto é exibida como 19,99% em vez dos 20% configurados.

<u>Etapas a serem reproduzidas</u>:

1. Vá para **[!UICONTROL Stores]** > **[!UICONTROL Settings]** > **[!UICONTROL Configuration]** > **[!UICONTROL Catalog]** > **[!UICONTROL Catalog]** > **[!UICONTROL Price]**.
1. Definir **[!UICONTROL Catalog Price Scope]** como *Site*.
1. Vá para **[!UICONTROL Stores]** > **[!UICONTROL Settings]** > **[!UICONTROL Configuration]** > **[!UICONTROL Sales]** > **[!UICONTROL Tax]** > **[!UICONTROL Calculation Settings]**.
   1. Defina **[!UICONTROL Tax Calculation Method Based On]** como *Preço Unitário*.
   1. Definir **[!UICONTROL Catalog Prices]** como *Incluindo Imposto*.
   1. Definir **[!UICONTROL Apply Discount On Prices]** como *Incluindo Imposto*.
1. Vá para **[!UICONTROL Stores]** > **[!UICONTROL Settings]** > **[!UICONTROL Configuration]** > **[!UICONTROL Sales]** > **[!UICONTROL Tax]** > **[!UICONTROL Default Tax Destination Calculation]**.
   1. Defina **[!UICONTROL Default Country]** como *França*.
1. Vá para **[!UICONTROL Stores]** > **[!UICONTROL Tax Zones and Rates]** > **[!UICONTROL Add new Tax Rate]**.
   1. Digite qualquer nome no campo **[!UICONTROL Tax Identifier]**.
   1. Digite um asterisco (*) no campo **[!UICONTROL Zip/Post Code]**.
   1. Defina **[!UICONTROL Country]** como *França*.
   1. Insira *20.000000* no campo **[!UICONTROL Rate Percent]**.
   1. Clique em **[!UICONTROL Save]**.
1. Vá para **[!UICONTROL Stores]** > **[!UICONTROL Tax Rules]** > **[!UICONTROL Add New Tax Rule]**.
   1. Digite qualquer nome no campo **[!UICONTROL Name]**.
   1. Defina **[!UICONTROL Tax Rate]** para a taxa adicionada na etapa anterior.
1. Vá para **[!UICONTROL Catalog]** > **[!UICONTROL Products]** > **[!UICONTROL Add Product]**.
   1. Insira *test* no campo **[!UICONTROL Product Name]**.
   1. Insira *test* no campo **[!UICONTROL SKU]**.
   1. Digite **82.65** no campo **[!UICONTROL Price]**.
   1. Defina **[!UICONTROL Tax Class]** como *Mercadorias Tributáveis*.
   1. Digite *100* no campo **[!UICONTROL Quantity]**.
   1. Clique em **[!UICONTROL Save]**.
1. Alterar escopo para *Exibição de Repositório Padrão*.
   1. Desmarcar **[!UICONTROL Use Default Value]** no Preço.
   1. Defina **[!UICONTROL Price]** como *68.87*.
   1. Desfazer a definição de **[!UICONTROL Use Default Value]** na Classe de Imposto.
   1. Defina **[!UICONTROL Tax Class]** como *Mercadorias tributáveis*. 
   1. Clique em **[!UICONTROL Save]**.
1. Vá para **[!UICONTROL Marketing]** > *[!UICONTROL Promotions]* > **[!UICONTROL Catalog Price Rule]** > **[!UICONTROL Add New Rule]**.
   1. Digite qualquer nome no campo **[!UICONTROL Rule Name]**.
   1. Defina **[!UICONTROL Active]** como *Sim*.
   1. Defina **[!UICONTROL Website]** como *Site Principal*.
   1. Configurar **[!UICONTROL Customer Groups]** para *todos*
   1. Em **[!UICONTROL Actions]**, defina **[!UICONTROL Apply]** como *Aplicar como porcentagem do original*.
   1. Insira *20.000000* no campo **[!UICONTROL Discount Amount]**.
   1. Clique em **[!UICONTROL Save]**.
1. Executar uma reindexação completa:

```
$ bin/magento index:reindex
```

1. Executar a seguinte consulta [!DNL GraphQL] com **[!UICONTROL Store]**: *padrão* definido nos cabeçalhos:

```
query{
products(filter: {sku: {eq: "test"}}, sort: {name: ASC}) {
    items {
      name
      sku
      price_range {
        minimum_price {
          regular_price {
            value
            currency
          }
          final_price {
            value
            currency
          }
          discount {
            amount_off
            percent_off
          }
        }
        maximum_price {
          regular_price {
            value
            currency
          }
          final_price {
            value
            currency
          }
          discount {
            amount_off
            percent_off
          }
        }
      }
    }
  }
}
  
```

<u>Resultados esperados</u>:

A porcentagem de desconto deve corresponder à regra do catálogo: 20%.

<u>Resultados reais</u>:

A porcentagem de desconto é exibida incorretamente como 19,99%.

## Aplicar o patch

Para aplicar patches individuais, use os links a seguir, dependendo do método de implantação:

* Adobe Commerce ou Magento Open Source local: [[!DNL Quality Patches Tool] > Uso](/help/tools/quality-patches-tool/usage.md) no guia [!DNL Quality Patches Tool].
* Adobe Commerce na infraestrutura em nuvem: [Atualizações e patches > Aplicar patches](https://experienceleague.adobe.com/docs/commerce-cloud-service/user-guide/develop/upgrade/apply-patches.html) no guia do Commerce na infraestrutura em nuvem.

## Leitura relacionada

Para saber mais sobre [!DNL Quality Patches Tool], consulte:

* [[!DNL Quality Patches Tool]: uma ferramenta de autoatendimento para patches de qualidade](/help/tools/quality-patches-tool/quality-patches-tool-to-self-serve-quality-patches.md) no guia Ferramentas.
