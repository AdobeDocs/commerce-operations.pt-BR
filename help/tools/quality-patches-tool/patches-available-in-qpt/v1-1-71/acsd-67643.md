---
title: 'ACSD-67643: Entradas duplicadas criadas durante atualizações agendadas em ambientes de categoria altamente aninhados'
description: Aplique o patch ACSD-67643 para corrigir o problema do Adobe Commerce em que entradas duplicadas são criadas durante atualizações programadas em ambientes com um alto número de categorias aninhadas.
feature: Catalog Management
role: Admin, Developer
type: Troubleshooting
source-git-commit: 62cb0633c9368e304914afe31bfd91c771f2f7e1
workflow-type: tm+mt
source-wordcount: '367'
ht-degree: 0%

---


# ACSD-67643: Entradas duplicadas criadas durante atualizações agendadas em ambientes de categoria altamente aninhados

O patch ACSD-67643 corrige o problema em que entradas duplicadas são criadas durante atualizações programadas em ambientes com um alto número de categorias aninhadas. Este patch está disponível quando o [[!DNL Quality Patches Tool (QPT)]](/help/tools/quality-patches-tool/quality-patches-tool-to-self-serve-quality-patches.md) 1.1.71 está instalado. A ID do patch é ACSD-67643. Observe que esse problema está programado para ser corrigido no Adobe Commerce 2.4.9.

## Produtos e versões afetados

**O patch foi criado para a versão do Adobe Commerce:**

* Adobe Commerce (todos os métodos de implantação) 2.4.8-p1

**Compatível com as versões do Adobe Commerce:**

* Adobe Commerce (todos os métodos de implantação) 2.4.8 - 2.4.8-p2

>[!NOTE]
>
>O patch pode se tornar aplicável a outras versões com as novas versões do [!DNL Quality Patches Tool]. Para verificar se o patch é compatível com a sua versão do Adobe Commerce, atualize o pacote `magento/quality-patches` para a versão mais recente e verifique a compatibilidade na [[!DNL Quality Patches Tool]: página Procurar patches](https://experienceleague.adobe.com/tools/commerce-quality-patches/index.html). Use a ID do patch como palavra-chave de pesquisa para localizar o patch.

## Problema

Entradas duplicadas ocorrem ao criar atualizações agendadas para ambientes que têm um grande número de categorias aninhadas.

<u>Etapas a serem reproduzidas</u>:

1. **Gerar dados de exemplo:**
Usar um arquivo de ajustes de desempenho (Por exemplo: `small.xml`) com modificações:
   **[!UICONTROL Categories]**: *2.500*
   **[!UICONTROL Products]**: *250.000*

1. Execute o seguinte comando:

   ```bash
   bin/magento setup:performance:generate-fixtures var/performance-toolkit/profiles/ce/small.xml
   ```

1. Depois de criar produtos e categorias, verifique se todas as categorias são âncoras executando:

   ```sql
   UPDATE catalog_category_entity_int SET value = 1 WHERE attribute_id = (SELECT attribute_id FROM eav_attribute WHERE attribute_code = 'is_anchor');
   ```

1. Executar uma reindexação completa.
1. Faça logon no back-end e abra a página **[!UICONTROL Categories]**.
1. Mover *Categoria 2* para *Categoria 1* para aumentar o aninhamento de árvore.
1. Ir para a categoria mais aninhada (Por exemplo: *Categoria 2.1.1*).
1. Crie uma **Atualização agendada** e salve a categoria.

<u>Resultados esperados</u>:

A categoria foi salva com sucesso.

<u>Resultados reais</u>:

Ocorre um *Erro 500*, e a seguinte mensagem é exibida nos logs:

```
    Magento\Framework\DB\Adapter\DuplicateException:
    SQLSTATE[23000]: Integrity constraint violation: 1062 Duplicate entry '6-165' for key 'PRIMARY', 
    query was: INSERT INTO `temp_category_descendants_68a35aea273fc` (`category_id`, `descendant_id`)
    SELECT `ce`.`entity_id` AS `category_id`, `ce2`.`entity_id` AS `descendant_id`
    FROM `catalog_category_entity` AS `ce`
    INNER JOIN `catalog_category_entity` AS `ce2` ON ce2.path LIKE CONCAT(ce.path, '/%')
```

## Aplicar o patch

Para aplicar patches individuais, use os links a seguir, dependendo do método de implantação:

* Adobe Commerce ou Magento Open Source local: [[!DNL Quality Patches Tool] > Uso](/help/tools/quality-patches-tool/usage.md) no guia [!DNL Quality Patches Tool]
* Adobe Commerce na infraestrutura em nuvem: [Atualizações e patches > Aplicar patches](https://experienceleague.adobe.com/docs/commerce-cloud-service/user-guide/develop/upgrade/apply-patches.html) no guia do Commerce na infraestrutura em nuvem

## Leitura relacionada

Para saber mais sobre [!DNL Quality Patches Tool], consulte:

* [[!DNL Quality Patches Tool]: uma ferramenta de autoatendimento para patches de qualidade](/help/tools/quality-patches-tool/quality-patches-tool-to-self-serve-quality-patches.md) no guia Ferramentas
