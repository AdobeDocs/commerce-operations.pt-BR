---
title: 'ACSD-68064: Entradas duplicadas criadas durante atualizações agendadas em ambientes com categorias profundamente aninhadas'
description: Aplique o patch ACSD-68064 para corrigir o problema do Adobe Commerce em que a criação de atualizações agendadas em ambientes com um alto número de categorias aninhadas resulta em entradas duplicadas e impede o salvamento de categorias.
feature: Catalog Management
role: Admin, Developer
type: Troubleshooting
source-git-commit: c7a955e6f9131255420ad0a163e457bd27cfc253
workflow-type: tm+mt
source-wordcount: '393'
ht-degree: 0%

---


# ACSD-68064: Entradas duplicadas criadas durante atualizações agendadas em ambientes com categorias profundamente aninhadas

O patch ACSD-68064 corrige o problema em que a criação de atualizações programadas em ambientes com um alto número de categorias aninhadas resulta em entradas duplicadas e impede o salvamento de categorias. Este patch está disponível quando o [[!DNL Quality Patches Tool (QPT)]](/help/tools/quality-patches-tool/quality-patches-tool-to-self-serve-quality-patches.md) 1.1.72 está instalado. A ID do patch é ACSD-68064. Observe que esse problema está programado para ser corrigido no Adobe Commerce 2.4.9.

## Produtos e versões afetados

**O patch foi criado para a versão do Adobe Commerce:**

* Adobe Commerce (todos os métodos de implantação) 2.4.7-p6

**Compatível com as versões do Adobe Commerce:**

* Adobe Commerce (todos os métodos de implantação) 2.4.7 - 2.4.7-p7

>[!NOTE]
>
>O patch pode se tornar aplicável a outras versões com as novas versões do [!DNL Quality Patches Tool]. Para verificar se o patch é compatível com a sua versão do Adobe Commerce, atualize o pacote `magento/quality-patches` para a versão mais recente e verifique a compatibilidade na [[!DNL Quality Patches Tool]: página Procurar patches](https://experienceleague.adobe.com/tools/commerce-quality-patches/index.html). Use a ID do patch como palavra-chave de pesquisa para localizar o patch.

## Problema

A criação de atualizações agendadas em ambientes com um alto número de categorias aninhadas resulta em entradas duplicadas, resultando em erros e falha ao salvar a categoria.

<u>Etapas a serem reproduzidas</u>:

1. Instale uma instância limpa.
1. Modifique o arquivo de correções de desempenho (small.xml) para incluir:
   1. **[!UICONTROL Categories]**: *2500*
   1. **[!UICONTROL Products]**: *250.000*
1. Gere os dados usando o comando:

   ```
   bin/magento setup:performance:generate-fixtures var/performance-toolkit/profiles/ce/small.xml
   ```

1. Depois de criar produtos e categorias, verifique se todas as categorias estão definidas como âncoras executando a seguinte query:

   ```
   UPDATE catalog_category_entity_int set value = 1 where attribute_id = (select attribute_id from eav_attribute where attribute_code = 'is_anchor'); 
   ```

1. Reindexe os dados.
1. Faça logon no painel Admin e navegue até **[!UICONTROL Catalog]** > **[!UICONTROL Categories]**.
1. Mova a **Categoria 2** para a **Categoria 1** para criar uma estrutura mais aninhada.
1. Ir para uma categoria profundamente aninhada, por exemplo, **Categoria 2.1.1**.
1. Criar um **[!UICONTROL Scheduled Update]**.
1. Clique em **[!UICONTROL Save]**.

<u>Resultados esperados</u>:

A categoria foi salva com sucesso.

<u>Resultados reais</u>:

Ocorre um erro e a categoria não é salva. `var/log/exception.log` contém um erro semelhante a:

```
Exception #0 (Magento\Framework\DB\Adapter\DuplicateException): SQLSTATE[23000]: Integrity constraint violation: 1062 Duplicate entry '229-255' for key 'temp_category_descendants_619aaaaaaaaaa.PRIMARY', query was: INSERT INTO `temp_category_descendants_619aaaaaaaaaa` (`category_id`, `descendant_id`) SELECT `ce`.`entity_id` AS `category_id`, `ce2`.`entity_id` AS `descendant_id` FROM `catalog_category_entity` AS `ce`
 INNER JOIN `catalog_category_entity` AS `ce2` ON ce2.path LIKE CONCAT(ce.path, '/%') OR ce2.entity_id = ce.entity_id AND (ce2.created_in <= '1750287600' AND ce2.updated_in > '1750287600') WHERE ((ce.entity_id IN (4, 6, 7, 8, 10, 24, 25, 27, 30, 33, 34, 35, 36, 37, 40, 41, 42, 43, 44, 48, 51, 54, 56, 57, 59, 60, 63, 64, 65, 66, 67 .......
```

## Aplicar o patch

Para aplicar patches individuais, use os links a seguir, dependendo do método de implantação:

* Adobe Commerce ou Magento Open Source local: [[!DNL Quality Patches Tool] > Uso](/help/tools/quality-patches-tool/usage.md) no guia [!DNL Quality Patches Tool].
* Adobe Commerce na infraestrutura em nuvem: [Atualizações e patches > Aplicar patches](https://experienceleague.adobe.com/docs/commerce-cloud-service/user-guide/develop/upgrade/apply-patches.html) no guia do Commerce na infraestrutura em nuvem.

## Leitura relacionada

Para saber mais sobre [!DNL Quality Patches Tool], consulte:

* [[!DNL Quality Patches Tool]: uma ferramenta de autoatendimento para patches de qualidade](/help/tools/quality-patches-tool/quality-patches-tool-to-self-serve-quality-patches.md) no guia Ferramentas.
